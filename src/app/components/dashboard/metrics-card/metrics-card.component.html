<div class="metrics-container">
  @let loading = (loading$ | async);
  @let error = (error$ | async);
  @if (!loading && !error) {
    <mat-card class="metric-card" @cardAppear>
      <mat-card-header>
        <mat-icon mat-card-avatar>people</mat-icon>
        <mat-card-title>
          <span class="title-label">Total Active Users</span>
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="metric-value" [@valueChange]="animationStates.totalActiveUsers">{{ metrics.totalActiveUsers | number }}</div>
      </mat-card-content>
    </mat-card>

    <mat-card class="metric-card" @cardAppear>
      <mat-card-header>
        <mat-icon mat-card-avatar>schedule</mat-icon>
        <mat-card-title>
          <span class="title-label">Avg Session Duration</span>
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="metric-value" [@valueChange]="animationStates.averageSessionDuration">{{ metrics.averageSessionDuration | duration }}</div>
      </mat-card-content>
    </mat-card>

    <mat-card class="metric-card" @cardAppear>
      <mat-card-header>
        <mat-icon mat-card-avatar>trending_up</mat-icon>
        <mat-card-title>
          <span class="title-label">Conversion Rate</span>
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="metric-value" [@valueChange]="animationStates.conversionRate">{{ (metrics.conversionRate * 100) | number:'1.0-1' }}<span class="unit">%</span></div>
      </mat-card-content>
    </mat-card>

    <mat-card class="metric-card" @cardAppear>
      <mat-card-header>
        <mat-icon mat-card-avatar>attach_money</mat-icon>
        <mat-card-title>
          <span class="title-label">Revenue Today</span>
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="metric-value" [@valueChange]="animationStates.revenueToday">${{ metrics.revenueToday | number:'1.0-2' }}</div>
      </mat-card-content>
    </mat-card>
  } @else {
    @if (loading) {
      <div class="state">
        <mat-spinner diameter="50"></mat-spinner>
        <p>Loading metricsâ€¦</p>
      </div>
    }
    @if (error) {
      <mat-card class="error-card">
        <mat-card-content>
          <mat-icon color="warn">error</mat-icon>
          <p>{{ error }}</p>
        </mat-card-content>
      </mat-card>
    }
  }
</div>
